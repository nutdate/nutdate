# --- Termux ZSH Setup for nutsenadns ---

# --- Oh My Zsh ---
export ZSH="$HOME/.oh-my-zsh"
if [ ! -d "$ZSH" ]; then
    pkg install -y git zsh curl
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi
ZSH_THEME="powerlevel10k/powerlevel10k"

plugins=(
  git
  zsh-autosuggestions
  zsh-syntax-highlighting
  autojump
  web-search
  common-aliases
  sudo
  aws
)

source $ZSH/oh-my-zsh.sh

# --- Environment Variables ---
export PATH="$HOME/.local/bin:$HOME/go/bin:$HOME/.cargo/bin:$HOME/bin:$PATH"

# --- GitHub Identity & Nutdate Repo ---
export GITHUB_USER="nutsenadns"
export GITHUB_EMAIL="nutsenadns@gmail.com"
git config --global user.name "$GITHUB_USER"
git config --global user.email "$GITHUB_EMAIL"

export GIT_MAIN_REPO_DIR="$HOME/projects/nutdate"
mkdir -p "$GIT_MAIN_REPO_DIR"

# Init git repo ถ้ายังไม่มี
if [ ! -d "$GIT_MAIN_REPO_DIR/.git" ]; then
    cd "$GIT_MAIN_REPO_DIR"
    git init
    git remote add origin "git@github.com:$GITHUB_USER/nutdate.git"
fi

# --- SSH Agent Auto Start ---
if [ -z "$SSH_AUTH_SOCK" ]; then
    eval $(ssh-agent -s)
    ssh-add ~/.ssh/id_ed25519 2>/dev/null
fi

# --- Shortcut navigation ---
alias cdgit='cd $GIT_MAIN_REPO_DIR'
alias myrepos='find ~/projects -type d -name ".git" | sed "s|/\.git||"'

# --- Git Aliases ---
alias gs='git status'
alias ga='git add .'
alias gc='git commit -m'
alias gp='git push'
alias gl='git log --oneline --graph --all'
alias gd='git diff'
alias gcl='git clone'
alias gco='git checkout'
alias gpull='git pull origin $(git rev-parse --abbrev-ref HEAD)'
alias gpush='git push origin $(git rev-parse --abbrev-ref HEAD)'
alias gb='git branch'
alias gclean='git clean -fd && git reset --hard'
alias gcleanall='git gc --aggressive --prune=now'
alias grecent='cd "$(find ~/projects -type d -name ".git" | xargs -n1 dirname | head -n 1)"'

# --- AWS Aliases ---
alias aws-ec2-ls='aws ec2 describe-instances --query "Reservations[].Instances[].[InstanceId, State.Name, Tags[?Key==\`Name\`].Value | [0]]" --output table'

# --- VPN Function ---
ssh-vpn() { ssh -i ~/.ssh/my_vpn_key ubuntu@"$1"; }

# --- Autojump Termux Compatibility ---
[[ -s /data/data/com.termux/files/usr/share/autojump/autojump.zsh ]] && source /data/data/com.termux/files/usr/share/autojump/autojump.zsh

# --- GitHub CLI Login Check ---
if ! command -v gh >/dev/null 2>&1; then
    pkg install -y gh
fi
if ! gh auth status &>/dev/null; then
  echo "⚠️ GitHub CLI ยังไม่ได้ login. รัน: gh auth login"
fi
